--
-- Created by IntelliJ IDEA.
-- User: gouet_v and wery_a
-- Date: 6/8/16
-- Time: 12:50 PM
-- To change this template use File | Settings | File Templates.
--

local path = "src_client_ai/lua/"

canAct = true;
Queue = require (path.."Queue")

dataQueue = {}
serverAnswer = {}

toto = 0


function OnStart()
   dataQueue = Queue.new()

   serverAnswer[MOVE] = onCallMove
   serverAnswer[LEFT] = onCallMove
   serverAnswer[RIGHT] = onCallMove
   serverAnswer[TAKE] = nil
   serverAnswer[DROP] = nil
   serverAnswer[LAYEGG] = nil
   serverAnswer[BROADCAST] = nil
end

function onCallMove(requestCode, responseServer)
   canAct = true
end

function onSeeAndAct()
   local i = 0

   while IA:GetSightAt(i) do
      if (IA:GetSightAt(i):HasObject(FOOD) == true and i == 0) then
	 Queue.push(dataQueue, {TAKE, "nourriture"})
      if (IA:GetNbNeededRessources(LINEMATE) == 1) then
	 Queue.push(dataQueue, {MOVE, nil})
      end
      i = i + 1
   end
end

function OnUpdate()
   
   if canAct == false then
      return NONE
   end

   local value = Queue.pop(dataQueue)

   if value then
      canAct = false
      if (value[2]) then
	 IA:SetParameter(value[2])
      end

      print(value[2])
      return value[1]
   end

   onSeeAndAct()
   return NONE
end

function OnReceive(requestCode, responseServer)
   if (serverAnswer[requestCode]) then
      serverAnswer[requestCode](requestCode, responseServer)
   else
      print(requestCode)
      print(responseServer)
   end
end
